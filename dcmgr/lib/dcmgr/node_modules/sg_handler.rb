# -*- coding: utf-8 -*-

module Dcmgr::NodeModules
  class SGHandler < Isono::NodeModules::Base
    M = Dcmgr::Models

    initialize_hook do
      app = Isono::Rack::ObjectMethod.new(myinstance)
      job = Isono::NodeModules::JobChannel.new(node)
      job.register_endpoint('sg_handler', Isono::Rack.build do
        use Isono::Rack::Sequel
        run proc { |req, res|
          Thread.current[M::BaseNew::LOCK_TABLES_KEY] = {}
          app.call(req, res)
        }
      end)
    end

    def add_sgs_to_vnic(vnic_uuid,sg_uuids)
      #TODO: Check if we're already in any of these sgs... log warning if we are
      p "adding secg to vnic: #{sg_uuids.inspect} #{vnic_uuid.inspect}"
    end

    def remove_sgs_from_vnic(vnic_uuid,sg_uuids)
      #TODO: Check if we are in these sgs... log warning if we aren't
      p "removing secg from vnic: #{sg_uuids.inspect} #{vnic_uuid.inspect}"
    end

    def event
      @event ||= Isono::NodeModules::EventChannel.new(@node)
    end

    # def job
    #   Isono::NodeModules::JobChannel.new(self.node)
    # end
  end
end
