# -*- coding: utf-8 -*-

module Dcmgr::NodeModules
  class SGHandler < Isono::NodeModules::Base
    include Dcmgr::Logger
    include Dcmgr::VNet::SGHandler
    include Dcmgr::VNet::CallIsonoPacketfilter

    initialize_hook do
      app = Isono::Rack::ObjectMethod.new(myinstance)
      myinstance.job.register_endpoint('sg_handler', Isono::Rack.build do
        use Isono::Rack::Sequel
        run proc { |req, res|
          Thread.current[M::BaseNew::LOCK_TABLES_KEY] = {}
          app.call(req, res)
        }
      end)
    end

  end
end
